(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const $="https://v2.api.noroff.dev",C="/auction",d=`${$}${C}`;function h(e,t){localStorage.setItem(e,JSON.stringify(t))}function g(e){try{const t=localStorage.getItem(e);return JSON.parse(t)}catch{return null}}function w(e){localStorage.removeItem(e)}function P(){return{"Content-Type":"application/json",Authorization:`Bearer ${g("token")}`,"X-Noroff-API-Key":"f14f6c96-21b5-4a80-a9c0-23adf4dc3986"}}async function u(e,t={}){return fetch(e,{...t,headers:P()})}const j="/listings",A="post";async function T(e){e.tags?e.tags=e.tags.split(",").map(i=>i.trim()):delete e.tags;const t=d+j,n=await u(t,{method:A,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`An error occurred while creating the listing: ${n.status}`);return await n.json()}const v="/listings";async function b(e="newest",t=null){let n=`${d}${v}?_seller=true&_active=true`;return e==="newest"?n+="&sort=updated&sortOrder=desc":e==="oldest"&&(n+="&sort=updated&sortOrder=asc"),t&&(n+=`&search?q=${t}`),await(await u(n)).json()}async function F(e){if(!e)throw new Error("Get listing requires id");const t=`${d}${v}/${e}?_seller=true&_active=true`;return await(await u(t)).json()}const k="/listings",I="put";async function N(e){if(!e)throw new Error("Update listing requires a listing id");e.tags?e.tags=e.tags.split(",").map(i=>i.trim()):delete e.tags;const t=`${d}${k}/${e.id}`,n=await u(t,{method:I,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`Failed to update listing: ${n.status}`);return await n.json()}const D="/listings",R="delete";async function _(e){if(!e)throw new Error("Delete listing requires a listing ID");const t=`${d}${D}/${e}`,n=await u(t,{method:R});if(!n.ok)throw new Error(`An error occurred while deleting the listing: ${n.status}`);if(n.status!==204)return await n.json()}function B(){const e=document.querySelector("#createListing");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=t.target,i=new FormData(n);let o=Object.fromEntries(i.entries());o.media=[];for(let r=1;r<=5;r++)o[`mediaUrl${r}`]&&o[`mediaAlt${r}`]&&(o.media.push({url:o[`mediaUrl${r}`],alt:o[`mediaAlt${r}`]}),delete o[`mediaUrl${r}`],delete o[`mediaAlt${r}`]);try{const r=await T(o);window.location.href=`/listing/?title=${r.data.title}&id=${r.data.id}`}catch(r){alert(r.message)}})}const J="/auth/login",H="post";async function M(e){const t=$+J,n=JSON.stringify(e),i=await fetch(t,{headers:{"Content-Type":"application/json"},method:H,body:n});if(!i.ok)throw new Error(`Login failed: ${i.status}`);const o=await i.json(),{accessToken:r,...a}=o.data;h("token",r),h("profile",a),window.location.href="/profile/"}async function G(){w("token"),w("profile"),window.location.href="/"}function K(){const e=document.querySelector("#loginForm");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=t.target,i=new FormData(n),o=Object.fromEntries(i.entries());try{await M(o)}catch(r){alert(r.message)}})}function z(){const e=document.querySelector("#logoutButton");e&&e.addEventListener("click",async t=>{if(t.preventDefault(),confirm("Are you sure you want to log out?"))try{await G()}catch(i){alert(i.message)}})}const X="/profiles";async function E(e){if(!e)throw new Error("Get profile requires a name");const t=`${d}${X}/${e}`;return await(await u(t)).json()}const Q="/profiles",V="put";async function W(e){if(!e.name)throw new Error("Update profile requires a name");const t=`${d}${Q}/${e.name}`;return await(await u(t,{method:V,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async function Y(){const{name:e}=g("profile"),t=await E(e),n=document.querySelector("#profile-container"),i=Z(t);return n.appendChild(i),t}Y();function Z(e){const t=document.createElement("div");t.classList.add("profileCard","col-md-9");const n=document.createElement("div");n.classList.add("card","border-0"),n.style.backgroundColor="inherit";const i=document.createElement("img");i.classList.add("card-img-top"),i.src=e.data.avatar.url,i.alt="Profile picture",i.style.borderRadius="0.25rem";const o=document.createElement("div");o.classList.add("card-body","text-center");const r=document.createElement("h5");r.classList.add("card-title","text-white","fw-bold"),r.textContent=e.data.name;const a=document.createElement("p");a.classList.add("card-title","text-white","fst-italic"),a.textContent=e.data.email;const c=document.createElement("p");c.classList.add("card-text","text-white"),c.textContent=e.data.bio;const s=document.createElement("p");return s.classList.add("card-text","text-white"),s.innerHTML="Credits: <span class='fst-italic'>"+e.data.credits+"</span>",o.append(r,a,c,s),n.append(i,o),t.appendChild(n),t}const ee="/auth/register",te="post";async function ne(e){const t=d+ee,n=JSON.stringify(e),i=await fetch(t,{headers:{"Content-Type":"application/json"},method:te,body:n});if(!i.ok)throw new Error(`Register failed: ${i.status}`);const o=await i.json();return windows.location.href="/login/",o}function oe(){const e=document.querySelector("#registerForm");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=t.target,i=new FormData(n),o=Object.fromEntries(i.entries());try{await ne(o)}catch(r){alert(r.message)}})}function re(e){const t=document.createElement("div");t.classList.add("listing","col-md-4");const n=document.createElement("a");n.classList.add("card","my-4"),n.href=`/listing/?title=${e.title}&id=${e.id}`,n.style.textDecoration="none",n.style.height="400px";const i=document.createElement("div");i.classList.add("card-body");const o=document.createElement("h5");o.classList.add("card-title"),o.innerText=`${e.title}`,o.style.textDecoration="underline";const r=document.createElement("p");r.classList.add("card-text"),r.innerText=`By seller: ${e.seller.name}`;const a=document.createElement("p");a.classList.add("card-text");const c=new Date(e.created),s={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},l=c.toLocaleString(void 0,s);a.innerText=`Created: ${l}`;const m=document.createElement("p");m.classList.add("card-text");const O=new Date(e.endsAt),q={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},U=O.toLocaleString(void 0,q);if(m.innerText=`Ending: ${U}`,i.append(o,r,a,m),e.media&&e.media.length>0){const f=document.createElement("img");f.src=e.media[0].url,f.alt=`Image from ${e.title}`,f.classList.add("card-img-top"),f.style.objectFit="cover",f.style.height="200px",n.prepend(f)}return n.append(i),t.append(n),t}function S(e,t){t.append(...e.map(re))}async function y(e="newest"){const t=await b(e);console.log(t);const n=document.querySelector(".listings");n&&(n.innerHTML="",S(t.data,n))}window.location.pathname==="/listings/"&&(document.querySelector("#selection").addEventListener("change",function(){y(this.value)}),y(document.querySelector("#selection").value));async function x(e=null){e||(e=new URLSearchParams(window.location.search).get("search"));const t=await b();if(t&&Array.isArray(t.data)){let n=t.data;e&&(n=t.data.filter(o=>o.title.toLowerCase().includes(e.toLowerCase())));const i=document.querySelector("#listing");i&&(i.innerHTML="",S(n,i))}}const L=document.querySelector("#search-form"),p=document.querySelector("#search");L&&L.addEventListener("submit",function(e){e.preventDefault();const t=p.value;window.location.href=`/listings/?search=${encodeURIComponent(t)}`});p&&p.addEventListener("input",function(){x(this.value)});x();async function ie(){const e=document.querySelector("#editListing"),n=new URL(location.href).searchParams.get("id");if(e){const i=e.querySelector("button"),o=document.querySelector("#deleteListing");i.disabled=!0;const r=await F(n);console.log(r),e.title.value=r.data.title,e.description.value=r.data.description,e.tags.value=r.data.tags,r.data.media.forEach((a,c)=>{const s=document.querySelector(`#mediaUrl${c+1}`),l=document.querySelector(`#mediaAlt${c+1}`);s&&l&&(s.value=a.url,l.value=a.alt)}),i.disabled=!1,e.addEventListener("submit",async a=>{a.preventDefault();const c=new FormData(e),s=Object.fromEntries(c.entries());s.id=n;try{await N(s),alert("Listing has been updated"),window.location.href="/profile/"}catch(l){alert(l.message)}}),o.addEventListener("click",async a=>{if(a.preventDefault(),window.confirm("Are you sure you want to delete this listing?"))try{await _(n),alert("Listing has been deleted"),window.location.href="/profile/"}catch(s){alert(s.message)}})}}async function ae(){const e=document.querySelector("#editProfile");if(e){const{name:t,email:n}=g("profile");e.name.value=t,e.email.value=n;const i=e.querySelector("button");i.disabled=!0;const o=await E(t);e.bio.value=o.data.bio,e.avatar.value=o.data.avatar.url,i.disabled=!1,e.addEventListener("submit",r=>{r.preventDefault();const a=r.target,c=new FormData(a),s=Object.fromEntries(c.entries());s.name=t,s.email=n,s.avatar={url:s.avatar},W(s).then(()=>{alert("Profile has been updated"),window.location.href="/profile/"}).catch(l=>{alert(l.message)})})}}function se(){switch(location.pathname){case"/profile/login/":case"/profile/login/index.html":K();break;case"/profile/register/":case"/profile/register/index.html":oe();break;case"/listing/create/":case"/listing/create/index.html":B();break;case"/listing/edit/":case"/listing/edit/index.html":ie();break;case"/profile/edit/":case"/profile/edit/index.html":ae();break}z()}se();
